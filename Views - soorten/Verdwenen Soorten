-- Stap 1: Selecteer de basisgegevens van de soorten
SELECT 
    s.id, 
    s.euring_code, 
    s.soort_naam
FROM soorten s
WHERE s.id IN (
    -- Stap 2: Selecteer soorten met een historisch 'track record'
    -- We groeperen de waarnemingen per soort en tellen de unieke jaren
    -- Alleen soorten die in >= 15 verschillende jaren territoria hadden blijven over
    SELECT soort_id 
    FROM waarnemingen
    WHERE territoria > 0
    GROUP BY soort_id
    HAVING COUNT(DISTINCT jaar) >= 10
)
AND s.id NOT IN (
    -- Stap 3: Sluit de soorten uit die de afgelopen 10 jaar nog zijn gezien
    -- Dit zorgt ervoor dat we alleen de 'echt verdwenen' soorten overhouden
    SELECT DISTINCT soort_id
    FROM waarnemingen
    WHERE jaar >= (2026 - 10) 
    AND territoria > 0
)
ORDER BY s.soort_naam ASC;ß®